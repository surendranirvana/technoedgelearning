"use strict";jQuery(document).ready(function(m){var a=null;function e(){m("#wc-moneris-expiry").length&&m("#wc-moneris-expiry").payment("formatCardExpiry")}function o(e){e.addClass("processing"),1!==e.data()["blockUI.isBlocked"]&&e.block({message:null,overlayCSS:{background:"#fff url("+wc_checkout_params.ajax_loader_url+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),a=Math.round((new Date).getTime()/1e3),m("#wc-moneris-account-number")[0].contentWindow.postMessage("",wc_moneris_hosted_tokenization_params.hosted_tokenization_url)}function n(e){if(-1!==e.origin.indexOf("moneris.com")){var o,n=m.parseJSON(e.data),t=Math.round((new Date).getTime()/1e3)-a;if(m.get(wc_moneris_hosted_tokenization_params.ajaxurl,{action:"wc_payment_gateway_moneris_handle_hosted_tokenization_response",orderId:wc_moneris_hosted_tokenization_params.order_id,responseCode:n.responseCode,errorMessage:n.errorMessage,token:n.dataKey,requestTime:t}),(o=m("form.checkout").length?m("form.checkout"):m("form#add_payment_method").length?m("form#add_payment_method"):m("form#order_review")).removeClass("processing").unblock(),n.responseCode<50){if(m("#wc-moneris-use-new-payment-method").val(n.dataKey),m("#wc-moneris-temp-payment-token").val(1),m("#wc-moneris-card-bin").val(n.bin),o.submit(),!m("form.checkout").length)o.addClass("processing"),1!==o.data()["blockUI.isBlocked"]&&o.block({message:null,overlayCSS:{background:"#fff url("+wc_checkout_params.ajax_loader_url+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})}else{m("#wc-moneris-use-new-payment-method").val(""),m("#wc-moneris-temp-payment-token").val("");var r=[];943===n.responseCode?r.push(wc_moneris_hosted_tokenization_params.card_number_missing_or_invalid):r.push(wc_moneris_hosted_tokenization_params.general_error),d(o,r)}}}function t(){window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent&&window.attachEvent("onmessage",n)}function r(e){if(e.is(".processing"))return!1;var o=m(".payment_method_moneris");if(o.find(".js-sv-wc-payment-gateway-payment-token:checked").val())return!0;var n,t=[],r=o.find("#wc-moneris-csc").val(),a=m.payment.cardExpiryVal(m("#wc-moneris-expiry").val()),s=(n=a).month<10?"0"+n.month:""+n.month,i=a.year,c=(new Date).getFullYear();return(/\D/.test(s)||/\D/.test(i)||12<s||s<1||i<c||c+20<i)&&t.push(wc_moneris_hosted_tokenization_params.card_exp_date_invalid),void 0!==r&&(r?(/\D/.test(r)&&t.push(wc_moneris_hosted_tokenization_params.cvv_digits_invalid),(r.length<3||4<r.length)&&t.push(wc_moneris_hosted_tokenization_params.cvv_length_invalid)):t.push(wc_moneris_hosted_tokenization_params.cvv_missing)),!(0<t.length)||(d(e,t),!1)}function s(){var e=m("#wc-moneris-use-new-payment-method");return!e||0===e.length||(!(!e.is(":checked")||e.val())||e.is('input[type="hidden"]')&&!e.val())}function d(e,o){m(".woocommerce-error, .woocommerce-message").remove(),e.prepend('<ul class="woocommerce-error"><li>'+o.join("</li><li>")+"</li></ul>"),e.removeClass("processing").unblock(),e.find(".input-text, select").blur(),m("html, body").animate({scrollTop:e.offset().top-100},1e3)}function i(){m("input.js-wc-moneris-payment-token").change(function(){var e=m("input.js-wc-moneris-payment-token:checked").val(),o=m("div.js-wc-moneris-new-payment-method-form"),n=m("#wc-moneris-csc").closest(".form-row");e?(o.slideUp(200),wc_moneris_hosted_tokenization_params.require_csc&&(n.removeClass("form-row-last").addClass("form-row-first"),o.after(n))):(o.slideDown(200),wc_moneris_hosted_tokenization_params.require_csc&&(n.removeClass("form-row-first").addClass("form-row-last"),o.find(".js-sv-wc-payment-gateway-credit-card-form-expiry").closest(".form-row").after(n)))}).change(),m("input#createaccount").change(function(){var e;e=m("input.js-wc-moneris-tokenize-payment-method").closest("p.form-row"),m(this).is(":checked")?(e.slideDown(),e.next().show()):(e.hide(),e.next().hide())}).change()}m("form.checkout").length?(t(),m(document.body).on("updated_checkout",function(){i()}),m("form.checkout").bind("checkout_place_order_moneris",function(){return s()?(o(m(this)),!1):r(m(this))})):m("form#add_payment_method").length?(t(),m("form#add_payment_method").on("submit",function(){return m("#wc-moneris-temp-payment-token").val()?r(m(this)):(o(m(this)),!1)})):(i(),t(),m("form#order_review").submit(function(){if("moneris"===m("#order_review input[name=payment_method]:checked").val())return s()?(o(m(this)),!1):r(m(this))})),m(document.body).on("updated_checkout",e),e()});